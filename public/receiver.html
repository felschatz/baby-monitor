<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Baby Monitor - Receiver</title>
    <link rel="stylesheet" href="/receiver.css">
</head>
<body>
    <!-- Session prompt overlay -->
    <div class="session-overlay" id="sessionOverlay">
        <div class="session-prompt">
            <h2>Enter Session Name</h2>
            <p>Use the same name as the sender to connect</p>
            <input type="text" id="sessionInput" placeholder="e.g., felix-baby" autocomplete="off" autocapitalize="none">
            <button class="btn btn-start" id="sessionJoinBtn">Join Session</button>
            <p class="session-hint">Bookmark the URL after joining for easy daily access</p>
        </div>
    </div>

    <!-- Disconnect alert overlay -->
    <div class="alert-overlay disconnect-alert" id="disconnectAlert">
        CONNECTION LOST
    </div>

    <div class="header">
        <a href="/" class="back-link">â†</a>
        <h2>Parent's Phone</h2>
        <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Connecting...</span>
        </div>
    </div>

    <div class="video-container" id="videoContainer">
        <video id="remoteVideo" autoplay playsinline muted></video>
        <div class="overlay" id="overlay">
            <div class="overlay-content">
                <p id="overlayText">Waiting for sender to start streaming...</p>
            </div>
        </div>
        <div class="audio-only-indicator" id="audioOnlyIndicator">
            <div class="audio-only-icon">ğŸ¤</div>
            <div class="audio-only-text">Audio Only</div>
            <div class="audio-only-subtext">Video disabled on sender</div>
        </div>
    </div>

    <!-- Baby audio level meter - prominent full-width row -->
    <div class="audio-meter-row">
        <span class="audio-meter-icon">ğŸ‘¶</span>
        <div class="audio-meter-bar">
            <div class="audio-meter-level" id="audioLevelInline"></div>
            <div class="audio-meter-threshold" id="thresholdMarkerInline"></div>
            <div class="audio-meter-noise-gate" id="noiseGateMarkerInline" style="display: none;"></div>
        </div>
        <span class="audio-meter-label">Baby</span>
    </div>

    <!-- Always-visible bottom bar with PTT and drawer toggle -->
    <div class="bottom-bar">
        <div class="ptt-container">
            <button class="ptt-btn" id="pttBtn" disabled>ğŸ¤</button>
            <div class="ptt-label" id="pttLabel">Hold to talk</div>
        </div>

        <button class="drawer-toggle" id="drawerToggle">
            <span class="drawer-toggle-icon">âš™</span>
            <span class="drawer-toggle-text">Controls</span>
        </button>
    </div>

    <!-- Info strip - always visible, shows current status -->
    <div class="info-strip">
        <div class="info-item">
            <span class="info-icon">ğŸ”Š</span>
            <span id="volumeDisplay">100%</span>
        </div>
        <div class="info-item">
            <span class="info-icon">ğŸ“Š</span>
            <span id="sensitivityDisplay">50</span>
        </div>
        <div class="info-item noise-gate-info" id="noiseGateInfoItem" style="display: none;">
            <span class="info-icon">ğŸ”‡</span>
            <span id="noiseGateDisplay">0</span>
        </div>
        <div class="info-item music-info" id="musicInfoItem" style="display: none;">
            <span class="info-icon">ğŸµ</span>
            <span id="musicStatusDisplay">â€”</span>
        </div>
        <div class="info-item shutdown-info" id="shutdownInfoItem" style="display: none;">
            <span class="info-icon">ğŸŒ™</span>
            <span id="shutdownStatusDisplay">â€”</span>
        </div>
        <span class="info-status" id="info">Waiting...</span>
    </div>

    <!-- Collapsible controls drawer -->
    <div class="controls-drawer" id="controlsDrawer">
        <div class="drawer-content">
            <div class="audio-meter">
                <div class="audio-level" id="audioLevel"></div>
                <div class="threshold-marker" id="thresholdMarker"></div>
                <div class="noise-gate-marker" id="noiseGateMarker"></div>
            </div>

            <div class="control-section">
                <label class="control-label">Volume</label>
                <div class="control-row">
                    <input type="range" id="volume" min="0" max="100" value="100" class="slider-input">
                    <span id="volumeValue" class="slider-value">100%</span>
                </div>
            </div>

            <div class="control-section">
                <label class="control-label">Alert Sensitivity</label>
                <div class="control-row">
                    <input type="range" id="sensitivity" min="10" max="100" value="50" class="slider-input">
                    <span id="sensitivityValue" class="slider-value">50</span>
                </div>
            </div>

            <div class="control-section">
                <label class="control-label">Noise Gate</label>
                <div class="control-row">
                    <input type="range" id="noiseGate" min="0" max="50" value="0" class="slider-input">
                    <span id="noiseGateValue" class="slider-value">Off</span>
                </div>
                <div class="control-hint" id="noiseGateHint">Mutes audio below threshold level</div>
            </div>

            <div class="control-section music-section" id="musicContainer" style="display: none;">
                <label class="control-label">Music</label>
                <div class="music-controls">
                    <button class="music-btn" id="musicBtn">ğŸµ</button>
                    <select class="music-playlist-select" id="musicPlaylistSelect" title="Select playlist"></select>
                    <select class="music-timer-select" id="musicTimerSelect">
                        <option value="45">45 min</option>
                        <option value="60">1 hour</option>
                    </select>
                    <button class="music-reset-btn" id="musicResetBtn" style="display: none;">Reset</button>
                </div>
                <div class="music-status" id="musicStatus"></div>
            </div>

            <div class="control-section toggles-section">
                <label class="toggle-option">
                    <input type="checkbox" id="audioOnlyToggle">
                    <span>Audio only mode</span>
                </label>
                <label class="toggle-option" id="echoCancelToggleLabel">
                    <input type="checkbox" id="echoCancelToggle">
                    <span>Reduce music echo</span>
                    <span class="experimental-badge">Beta</span>
                </label>
            </div>

            <div class="control-section shutdown-section" id="shutdownContainer">
                <label class="control-label">Auto-shutdown</label>
                <div class="shutdown-controls">
                    <button class="shutdown-btn" id="shutdownBtn" title="Shutdown now">ğŸŒ™</button>
                    <select class="timer-select" id="shutdownTimerSelect">
                        <option value="0">Disabled</option>
                        <option value="4">4 hours</option>
                        <option value="6" selected>6 hours</option>
                        <option value="8">8 hours</option>
                        <option value="10">10 hours</option>
                    </select>
                    <button class="shutdown-reset-btn" id="shutdownResetBtn" style="display: none;">Reset</button>
                </div>
                <div class="shutdown-status" id="shutdownStatus"></div>
                <div class="control-hint">Sender stops streaming after this time</div>
            </div>


            <div class="control-section test-sound-section">
                <label class="control-label">Test Sound</label>
                <button class="test-sound-btn" id="testSoundBtn" disabled>Send test ping</button>
                <div class="control-hint">Injects a short ping into the baby audio stream</div>
            </div>

            <button class="fullscreen-btn" id="fullscreenBtn">â›¶ Fullscreen</button>
        </div>
    </div>

    <script type="module" src="/js/receiver-app.js"></script>
</body>
</html>